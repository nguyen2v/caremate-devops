#+title: Setup database
#+date: <2025-01-08 Wed 15:08>
#+startup: content
#+property: header-args :noweb yes :results none
#+filetags: ::
- tags ::
- source ::

* Backup
** Backup SSH into `dhp-server`
#+begin_src bash
ssh dhp@${DHP_SERVER}
z ~/dhp-platform
#+end_src

** Run backup script
#+begin_src bash
./scripts/backup-database-local.sh
#+end_src

** Copy backup file from =dhp-server= to local
- Exit ssh session, then run the command below:
#+begin_src bash
scp dhp@${DHP_SERVER}:~/dhp-platform/dhp_backup.zip .
#+end_src

* Restore
** Copy Backup file from local to =dhp-server=
#+begin_src bash
docker cp dhp_backup.sql postgres:/dhp_backup.sql
#+end_src

** Restore SSH into =dhp-server=
#+begin_src bash
ssh dhp@${DHP_SERVER}
z ~/dhp-platform
#+end_src

** Run restore script
#+begin_src bash
docker exec postgres /usr/local/bin/psql -U dhp -d dhp -a -f dhp_backup.sql
#+end_src

* Cleanup backup files
#+begin_src bash
ssh dhp@${DHP_SERVER}
z ~/dhp-platform
rm -rf dhp_backup.sql dhp_backup.zip
#+end_src
