#+title: Setup Server With Ansible
#+date: <2025-04-18 Fri 11:47>
#+startup: content
#+property: header-args :noweb yes :dir (projectile-project-root) :results none
#+filetags: :Setup:Ansible:

* Add new server IP to /etc/hosts
- Add jiti-server IP to your =/etc/hosts=
#+begin_src conf
34.142.157.137 jitsi-server
#+end_src

- Verify ssh connection
#+begin_src bash
ssh dhp@jitsi-server
#+end_src

* Setup core config
#+begin_src bash
ansible-playbook -v playbooks/setup-core-config.yaml
#+end_src

* Setup Docker
#+begin_src bash
ansible-playbook -v playbooks/setup-docker.yaml
#+end_src

* Setup Jitsi Meet
** Configure DNS
- Navigate to =https://ap.www.namecheap.com/domains/domaincontrolpanel/fpt.healthcare/domain=
- Go to =Advanced DNS= then add or edit record with host =meet= like table below:
| Type     | Host |          Value | TTL       |
|----------+------+----------------+-----------|
| A Record | meet | 34.142.157.137 | Automatic |

** Configure ansible variables
- Edit =playbooks/host_vars/jitsi-server.yaml=, update =host_ip= to match jitsi-server IP, example:
#+begin_src
host_ip: 34.142.157.137
#+end_src

** Setup SSH key
#+begin_src bash
ansible-playbook -v playbooks/setup-ssh-key.yaml
#+end_src

** Install Jitsi docker stack
#+begin_src bash
ansible-playbook -v playbooks/install-jitsi-docker-stack.yaml
#+end_src

** Setup Build Jitsi docker
#+begin_src bash
ansible-playbook -v playbooks/setup-build-jitsi-docker.yaml
#+end_src

** Build Jitsi web docker
#+begin_src bash
ansible-playbook -v playbooks/build-jitsi-web-docker.yaml
#+end_src

** Build Jitsi Jigasi docker
#+begin_src bash
ansible-playbook -v playbooks/build-jitsi-jigasi-docker.yaml
#+end_src

** Configure Jitsi docker stack
#+begin_src bash
ansible-playbook -v playbooks/configure-jitsi-docker-stack.yaml
#+end_src

** Check Jitsi logs
:PROPERTIES:
:header-args: :dir /ssh:dhp@jitsi-server:/home/dhp/jitsi/jitsi-docker-jitsi-meet-3de7148 :session jitsi-server :results none
:END:

- Check =web= logs
#+begin_src bash
docker compose logs web
#+end_src

- Check =transcriber= logs
#+begin_src bash
docker compose logs transcriber
#+end_src
