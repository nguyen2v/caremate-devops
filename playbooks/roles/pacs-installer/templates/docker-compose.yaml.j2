services:
  # BEGIN ANSIBLE MANAGED NGINX BLOCK
  nginx:
    image: nginx@sha256:88b3388ea06c7262e410a3ab5c05dc4088b7b39dea569addd8c30766f4f47440
    container_name: nginx
    ports:
      - 80:80
      - 443:443
    volumes:
      - ${CONFIG_DIR}/nginx/{{ domain_name }}.conf:/etc/nginx/conf.d/{{ domain_name }}.conf:ro
      - ${CONFIG_DIR}/certbot/conf:/etc/letsencrypt:ro
      - ${CONFIG_DIR}/certbot/www:/var/www/certbot:ro
    networks:
      - pacs-network
    restart: unless-stopped
  # END ANSIBLE MANAGED NGINX BLOCK

  # BEGIN ANSIBLE MANAGED PACS-SERVER BLOCK
  pacs-server:
    container_name: pacs-server
    image: jodogne/orthanc-plugins:1.12.10
    environment:
      ORTHANC_NAME: "Caremate"
    ports:
      - 8042:8042
    volumes:
      - ${CONFIG_DIR}/orthanc/orthanc.json:/etc/orthanc/orthanc.json:ro
      - orthanc-db:/var/lib/orthanc/db/
    networks:
      - pacs-network
    restart: unless-stopped
  # END ANSIBLE MANAGED PACS-SERVER BLOCK

  # BEGIN ANSIBLE MANAGED CERTBOT BLOCK
  certbot:
    image: certbot/certbot
    container_name: certbot
    volumes:
      - ${CONFIG_DIR}/certbot/conf:/etc/letsencrypt
      - ${CONFIG_DIR}/certbot/www:/var/www/certbot
    command: >
      certonly --agree-tos
        --domain {{ domain_name }}
        --email duongtq@fpt.com
        --force-renewal
        --webroot
        --webroot-path /var/www/certbot
  # END ANSIBLE MANAGED CERTBOT BLOCK

networks:
  pacs-network:

volumes:
  orthanc-db:
